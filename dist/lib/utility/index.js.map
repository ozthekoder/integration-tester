{"version":3,"sources":["../../../src/lib/utility/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import defaults from '../config/config.json';\nconst is =  (function toType(global) {\n  return function(obj) {\n    if (obj === global) {\n      return \"global\";\n    }\n    return ({}).toString.call(obj).match(/\\s([a-z|A-Z]+)/)[1].toLowerCase();\n  }\n})(global);\n\nconst forEachKey = (obj, cb) => {\n  if(obj && is(obj) === 'object') {\n    const keys = Object.keys(obj);\n    let i;\n    for(i=0; i<keys.length; i++) {\n      cb(keys[i], i, keys);\n    }\n  }\n};\n\nconst xor = (predicates) => {\n  return predicates\n  .reduce((prev, predicate) => ( ( prev && !predicate ) || ( !prev && predicate ) ), false);\n};\n\nconst isJsonSafePrimitive = (value) => {\n  return (\n    typeof value === 'number' ||\n      typeof value === 'string' ||\n      typeof value === 'boolean'\n  );\n};\n\nconst generateAssertions = (json, path='payload') => {\n  const keys = Object.keys(json);\n  const length = keys.length;\n  const assert = 'equal';\n  let expect = {};\n  let log;\n  for(let i = 0; i < length; i++) {\n    const key = keys[i];\n    const value = json[key];\n    if (this.isJsonSafePrimitive(value)) {\n      log = `${path}.${key} should be ${value}`;\n      expect[key] = {\n        value,\n        assert,\n        log\n      };\n    } else {\n      expect[key] = generateAssertions(value, `${path}.${key}`);\n    }\n  }\n\n  return expect;\n};\n\nconst getAllAssertions = (actual, expectation) => {\n  let tests = [];\n\n  if (expectation.$assert && expectation.$value) {\n    tests.push({\n      expectation: expectation.$value,\n      actual: actual,\n      assertion: expectation.$assert,\n      log: expectation.$log\n    });\n  } else {\n    const keys = Object.keys(expectation);\n    const length = keys.length;\n\n    for(var i = 0; i < length; i++) {\n      tests = tests.concat(getAllAssertions((actual ? actual[keys[i]] : null), expectation[keys[i]]));\n    }\n  }\n  return tests;\n};\n\nconst countAssertions = (obj) => {\n  let count = 0;\n\n  if (obj.$assert && obj.$value) {\n    ++count;\n  } else {\n    const keys = Object.keys(obj);\n    const length = keys.length;\n\n    for(var i = 0; i < length; i++) {\n      count += countAssertions(obj[keys[i]]);\n    }\n  }\n  return count;\n};\n\nconst getReferences = (actual, toSave) => {\n  let refs = {};\n\n  if (toSave &&\n      is(toSave) === 'string' &&\n        toSave.indexOf('___#') === 0 &&\n          toSave.indexOf('#___') === (toSave.length - 4)) {\n    toSave = toSave.slice(4, -4);\n  refs[toSave] = actual;\n  } else if (toSave && actual && ( is(toSave) === 'object' || is(toSave) === 'array' )){\n    const keys = Object.keys(toSave);\n    const length = keys.length;\n\n    for(var i = 0; i < length; i++) {\n      refs = Object.assign(refs, getReferences((actual ? actual[keys[i]] : null), toSave[keys[i]]));\n    }\n  }\n  return refs;\n};\n\nconst applyReferences = (saved, op) => {\n\n  const tpl = JSON.stringify(op);\n  let pieces = tpl.split(/(\\\"\\$\\{[\\s]*.*?[\\s]*\\}\\\")/g);\n  let inflated = pieces\n  .map((p) => {\n    if(/(\\\"\\$\\{[\\s]*.*?[\\s]*\\}\\\")/g.test(p)) {\n      let fromSaved = saved[(p.slice(3, -2))];\n\n      if(is(fromSaved) === 'array' || is(fromSaved) === 'object') {\n        fromSaved = JSON.stringify(fromSaved);\n      } else if(is(fromSaved) === 'string') {\n        fromSaved = `\"${fromSaved}\"`;\n      }\n      p = fromSaved;\n    }\n\n    return p;\n  })\n  .reduce((prev, current) => `${prev}${current}`, '');\n\n  pieces = inflated.split(/(\\$\\{[\\s]*.*?[\\s]*\\})/g);\n  inflated = pieces\n  .map((p) => {\n    if(/(\\$\\{[\\s]*.*?[\\s]*\\})/g.test(p)) {\n      let fromSaved = saved[(p.slice(2, -1))];\n\n      if(is(fromSaved) === 'array' || is(fromSaved) === 'object') {\n        fromSaved = JSON.stringify(fromSaved);\n      }\n      p = fromSaved;\n    }\n\n    return p;\n  })\n  .reduce((prev, current) => `${prev}${current}`, '');\n  return JSON.parse(inflated);\n};\n\nconst createURL = (endpoint, config = defaults.plugins.http) => {\n  const { host, port, path } = config;\n    return `http://${host}:${port}${path}${endpoint}`;\n}\n\n  export {\n    is,\n    forEachKey,\n    xor,\n    isJsonSafePrimitive,\n    createURL,\n    generateAssertions,\n    getReferences,\n    applyReferences,\n    getAllAssertions,\n    countAssertions\n  };\n"]}